Homework 6
================
Eileen Shea
November 27, 2018

## Problem 1

First we need to read in the data.

``` r
homicide_data = read_csv("./data/homicide-data.csv")
```

    ## Parsed with column specification:
    ## cols(
    ##   uid = col_character(),
    ##   reported_date = col_integer(),
    ##   victim_last = col_character(),
    ##   victim_first = col_character(),
    ##   victim_race = col_character(),
    ##   victim_age = col_character(),
    ##   victim_sex = col_character(),
    ##   city = col_character(),
    ##   state = col_character(),
    ##   lat = col_double(),
    ##   lon = col_double(),
    ##   disposition = col_character()
    ## )

Next we will create a `city_state` variable and a binary variable
indicating whether the homicide is solved. We will also omit the cities
Dallas, TX; Phoenix, AZ; Kansas City, MO; and Tulsa, AL. Lastly, we will
modify `victim_race` to have categories white and non-white, with white
as the reference category, and change victim\_age to a numeric variable.

``` r
US_hom_data = homicide_data %>% 
  mutate(state = toupper(state), city_state = str_c(city, state, sep = ", "),
        resolved = ifelse(disposition == "Closed without arrest" | disposition == "Open/No arrest", FALSE, TRUE)) %>% 
  filter(city_state != "Dallas, TX", city_state != "Phoenix, AZ", city_state != "Kansas City, MO", city_state != "Tulsa, AL") %>% 
  mutate(victim_race = ifelse(victim_race == "White", "White", "Non-White"),
         victim_race = factor(victim_race, levels = c("White", "Non-White")),
         victim_age  = as.numeric(victim_age))
```

    ## Warning in evalq(as.numeric(victim_age), <environment>): NAs introduced by
    ## coercion

Now for the city of Baltimore, MD we will fit a logistic regression
model with resolved vs unresolved as the outcome and victim age, sex,
and race as predictors.

``` r
Baltimore_log_reg = 
  US_hom_data %>% 
  filter(city_state == "Baltimore, MD") %>% 
  glm(resolved ~ victim_age + victim_sex + victim_race, 
    data = .,
    family = binomial())
```

Using the saved object of the `glm` output, we will tidy and obtain the
estimate and confidence interval of the adjusted odds ratio for solving
homicides comparing non-white victims to white victims keeping all other
variables fixed.

**OR and its Confidence Interval:**

``` r
Baltimore_log_reg %>% 
  broom::tidy() %>% 
  filter(term == "victim_raceNon-White") %>% 
  mutate(est_OR = exp(estimate), 
        OR_CI_low = exp(estimate - 1.96*std.error),
        OR_CI_high = exp(estimate + 1.96*std.error)) %>% 
  select(est_OR, OR_CI_low, OR_CI_high) %>% 
  knitr::kable(digits = 3)
```

| est\_OR | OR\_CI\_low | OR\_CI\_high |
| ------: | ----------: | -----------: |
|   0.441 |       0.313 |         0.62 |

Now we will run the `glm` function and extract the adjusted odds ratio
and confidence interval for each city.

``` r
city_log_reg = 
  US_hom_data %>% 
  group_by(city_state) %>% 
  nest() %>% 
  mutate(models = map(data, ~glm(resolved ~ victim_age + victim_sex + victim_race, data = .x, family = binomial())),
         models = map(models, broom::tidy)) %>% 
  select(-data) %>% 
  unnest()
```

``` r
city_OR_df = city_log_reg %>% 
  filter(term == "victim_raceNon-White") %>% 
  mutate(est_OR = exp(estimate), 
        OR_CI_low = exp(estimate - 1.96*std.error),
        OR_CI_high = exp(estimate + 1.96*std.error)) %>% 
  select(city_state, est_OR, OR_CI_low, OR_CI_high)
```

With this dataframe containing ORs and confidence intervals for each
city, we can make a plot.
